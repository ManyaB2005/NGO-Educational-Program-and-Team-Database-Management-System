<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teams Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

    <div class="app-container">
        <header class="header">
            <div class="hamburger" onclick="toggleSidebar()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <h2 class="header-title">Teams Management</h2>
            <a href="index.html" class="logout-btn">Logout</a>
        </header>

        <nav class="sidebar">
            <div class="sidebar-header">Menu</div>
            <a href="dashboard.html" class="nav-link"><div class="nav-icon">ğŸ </div>Dashboard</a>
            <a href="member.html" class="nav-link"><div class="nav-icon">ğŸ‘¥</div>Members</a>
            <a href="teams.html" class="nav-link active"><div class="nav-icon">ğŸ¤</div>Teams</a>
            <a href="education.html" class="nav-link"><div class="nav-icon">ğŸ“</div>Education</a>
            <a href="member_education.html" class="nav-link"><div class="nav-icon">ğŸ“š</div>Member Education</a>
            <a href="education_skills.html" class="nav-link"><div class="nav-icon">ğŸ’¡</div>Education Skills</a>
            <a href="session.html" class="nav-link"><div class="nav-icon">ğŸ“…</div>Sessions</a>
            <a href="events.html" class="nav-link"><div class="nav-icon">ğŸ‰</div>Events</a>
            <a href="query.html" class="nav-link"><div class="nav-icon">ğŸ“Š</div>Query Dashboard</a>
        </nav>

        <main class="content">
            <section class="hero">
                <h1>Teams Management</h1>
                <p>Organize and oversee team structures and capacity.</p>
            </section>

            <div class="container">
                <h2 class="section-heading page-title">Manage Teams</h2>
                <div class="tab-content">
                    <form id="teamForm">
                        <div class="form-group">
                            <label for="Team_ID">Team ID</label>
                            <input type="number" id="Team_ID" placeholder="Enter ID" required>
                        </div>
                        <div class="form-group">
                            <label for="Team_Name">Team Name</label>
                            <input type="text" id="Team_Name" placeholder="e.g., Outreach Team" required>
                        </div>
                        <div class="form-group">
                            <label for="Team_Size">Team Capacity</label>
                            <input type="number" id="Team_Size" placeholder="Max members" required>
                        </div>
                        <div class="form-group form-actions">
                            <button type="submit"><i class="fas fa-users-cog"></i> Add Team</button>
                            <button type="button" id="updateBtn" style="display:none;"><i class="fas fa-edit"></i> Update Team</button>
                        </div>
                    </form>
                </div>
                <h2 class="section-heading">Existing Teams</h2>
                <div class="table-container">
                    <table id="teamTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Capacity</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        function toggleSidebar() {
            document.querySelector('.app-container').classList.toggle('sidebar-open');
        }

        async function loadTeams() {
            const res = await fetch("/teams");
            const data = await res.json();
            const tbody = document.querySelector("#teamTable tbody");
            tbody.innerHTML = "";
            data.forEach(t => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${t.Team_ID}</td>
                    <td>${t.Team_Name}</td>
                    <td>${t.Team_Size}</td>
                    <td>
                        <button onclick="editTeam(${t.Team_ID})" title="Edit"><i class="fas fa-pencil-alt"></i></button> 
                        <button onclick="deleteTeam(${t.Team_ID})" title="Delete"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        async function deleteTeam(id) {
            if (!confirm(`Are you sure you want to delete Team ID ${id}?`)) return;
            await fetch(`/deleteTeam/${id}`, {
                method: "DELETE"
            });
            loadTeams();
        }

        async function editTeam(id) {
            try {
                const res = await fetch("/teams");
                if (!res.ok) throw new Error("Failed to fetch teams");
                const data = await res.json();
                const team = data.find(t => t.Team_ID == id);
                if (team) {
                    document.getElementById("Team_ID").value = team.Team_ID;
                    document.getElementById("Team_ID").readOnly = true;
                    document.getElementById("Team_Name").value = team.Team_Name;
                    document.getElementById("Team_Size").value = team.Team_Size;
                    document.getElementById("updateBtn").style.display = "inline";
                    document.querySelector("button[type='submit']").style.display = "none";
                    document.getElementById("updateBtn").onclick = () => updateTeam(id);
                    document.getElementById("teamForm").scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                alert("Error editing team: " + error.message);
            }
        }

        async function updateTeam(id) {
            try {
                const data = {
                    Team_Name: document.getElementById("Team_Name").value,
                    Team_Size: +document.getElementById("Team_Size").value
                };
                const res = await fetch(`/updateTeam/${id}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });
                if (!res.ok) throw new Error("Failed to update team");
                document.getElementById("Team_ID").readOnly = false;
                document.getElementById("teamForm").reset();
                document.getElementById("updateBtn").style.display = "none";
                document.querySelector("button[type='submit']").style.display = "inline";
                loadTeams();
            } catch (error) {
                alert("Error updating team: " + error.message);
            }
        }
        document.getElementById("teamForm").addEventListener("submit", async e => {
            e.preventDefault();
            const data = {
                Team_ID: +document.getElementById("Team_ID").value,
                Team_Name: document.getElementById("Team_Name").value,
                Team_Size: +document.getElementById("Team_Size").value
            };
            await fetch("/addTeam", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            document.getElementById("teamForm").reset();
            loadTeams();
        });
        loadTeams();
    </script>
</body>

</html>