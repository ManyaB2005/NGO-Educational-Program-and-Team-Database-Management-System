<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events Management</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="app-container">
        <header class="header">
            <div class="hamburger" onclick="toggleSidebar()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <h2 class="header-title">Events Management</h2>
            <a href="index.html" class="logout-btn">Logout</a>
        </header>

        <nav class="sidebar">
            <div class="sidebar-header">Menu</div>
            <a href="dashboard.html" class="nav-link"><div class="nav-icon">ğŸ </div>Dashboard</a>
            <a href="member.html" class="nav-link"><div class="nav-icon">ğŸ‘¥</div>Members</a>
            <a href="teams.html" class="nav-link"><div class="nav-icon">ğŸ¤</div>Teams</a>
            <a href="education.html" class="nav-link"><div class="nav-icon">ğŸ“</div>Education</a>
            <a href="member_education.html" class="nav-link"><div class="nav-icon">ğŸ“š</div>Member Education</a>
            <a href="education_skills.html" class="nav-link"><div class="nav-icon">ğŸ’¡</div>Education Skills</a>
            <a href="session.html" class="nav-link"><div class="nav-icon">ğŸ“…</div>Sessions</a>
            <a href="events.html" class="nav-link active"><div class="nav-icon">ğŸ‰</div>Events</a>
            <a href="query.html" class="nav-link"><div class="nav-icon">ğŸ“Š</div>Query Dashboard</a>
        </nav>

        <main class="content">
            <section class="hero">
                <h1>Events Management</h1>
                <p>Plan and coordinate community events and initiatives</p>
            </section>

            <div class="container">
                <h2 class="section-heading page-title">Plan and Coordinate Events</h2>
                <div class="tab-content">
                    <form id="eventForm">
                        <div class="form-group">
                            <label for="Event_ID">Event ID</label>
                            <input type="number" id="Event_ID" placeholder="Enter ID" required>
                        </div>
                        <div class="form-group">
                            <label for="Event_Name">Event Name</label>
                            <input type="text" id="Event_Name" placeholder="e.g., Annual Cleanup Drive" required>
                        </div>
                        <div class="form-group">
                            <label for="Event_Date">Event Date</label>
                            <input type="date" id="Event_Date" required>
                        </div>
                        <div class="form-group">
                            <label for="Event_Duration">Duration (Hours)</label>
                            <input type="number" id="Event_Duration" placeholder="e.g., 4" required>
                        </div>
                        <div class="form-group">
                            <label for="Event_Location">Location</label>
                            <input type="text" id="Event_Location" placeholder="e.g., Central Park" required>
                        </div>
                        <div class="form-group">
                            <label for="Number_of_Participants">Expected Participants</label>
                            <input type="number" id="Number_of_Participants" placeholder="e.g., 50" required>
                        </div>
                        <div class="form-group">
                            <label for="Team_ID">Organizing Team ID</label>
                            <input type="number" id="Team_ID" placeholder="Enter Team ID" required>
                        </div>
                        <div class="form-group form-actions">
                            <button type="submit"><i class="fas fa-calendar-check"></i> Add Event</button>
                            <button type="button" id="updateBtn" style="display:none;"><i class="fas fa-edit"></i> Update Event</button>
                        </div>
                    </form>
                </div>
                <h2 class="section-heading">Upcoming & Past Events</h2>
                <div class="table-container">
                    <table id="eventTable">
                        <thead>
                            <tr>
                                <th>ID</th><th>Name</th><th>Date</th><th>Duration</th><th>Location</th><th>Participants</th><th>Team</th><th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

<script>
    function toggleSidebar() {
        document.querySelector('.app-container').classList.toggle('sidebar-open');
    }

    async function loadEvents(){
        const res = await fetch("/events");
        const data = await res.json();
        const tbody = document.querySelector("#eventTable tbody");
        tbody.innerHTML = "";
        data.forEach(e=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${e.Event_ID}</td>
                <td>${e.Event_Name}</td>
                <td>${e.Event_Date?.split("T")[0]}</td>
                <td>${e.Event_Duration}</td>
                <td>${e.Event_Location}</td>
                <td>${e.Number_of_Participants}</td>
                <td>${e.Team_ID}</td>
                <td>
                    <button onclick="editEvent(${e.Event_ID})" title="Edit"><i class="fas fa-pencil-alt"></i></button> 
                    <button onclick="deleteEvent(${e.Event_ID})" title="Delete"><i class="fas fa-trash"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function deleteEvent(id){
        if (!confirm(`Are you sure you want to delete Event ID ${id}?`)) return;
        await fetch(`/deleteEvent/${id}`,{method:"DELETE"});
        loadEvents();
    }

    async function editEvent(id){
        try {
            const res = await fetch("/events");
            if (!res.ok) throw new Error("Failed to fetch events");
            const data = await res.json();
            const event = data.find(e => e.Event_ID == id);
            if(event){
                document.getElementById("Event_ID").value = event.Event_ID;
                document.getElementById("Event_ID").readOnly = true;
                document.getElementById("Event_Name").value = event.Event_Name;
                document.getElementById("Event_Date").value = event.Event_Date?.split("T")[0];
                document.getElementById("Event_Duration").value = event.Event_Duration;
                document.getElementById("Event_Location").value = event.Event_Location;
                document.getElementById("Number_of_Participants").value = event.Number_of_Participants;
                document.getElementById("Team_ID").value = event.Team_ID;
                document.getElementById("updateBtn").style.display = "inline";
                document.querySelector("button[type='submit']").style.display = "none";
                document.getElementById("updateBtn").onclick = () => updateEvent(id);
                document.getElementById("eventForm").scrollIntoView({ behavior: 'smooth' });
            }
        } catch (error) {
            alert("Error editing event: " + error.message);
        }
    }

    async function updateEvent(id){
        try {
            const data = {
                Event_Name: document.getElementById("Event_Name").value,
                Event_Date: document.getElementById("Event_Date").value,
                Event_Duration: +document.getElementById("Event_Duration").value,
                Event_Location: document.getElementById("Event_Location").value,
                Number_of_Participants: +document.getElementById("Number_of_Participants").value,
                Team_ID: +document.getElementById("Team_ID").value
            };
            const res = await fetch(`/updateEvent/${id}`, {method:"PUT", headers:{"Content-Type":"application/json"}, body: JSON.stringify(data)});
            if (!res.ok) throw new Error("Failed to update event");
            document.getElementById("Event_ID").readOnly = false;
            document.getElementById("eventForm").reset();
            document.getElementById("updateBtn").style.display = "none";
            document.querySelector("button[type='submit']").style.display = "inline";
            loadEvents();
        } catch (error) {
            alert("Error updating event: " + error.message);
        }
    }

    document.getElementById("eventForm").addEventListener("submit", async e=>{
        e.preventDefault();
        const data={
            Event_ID:+document.getElementById("Event_ID").value,
            Event_Name:document.getElementById("Event_Name").value,
            Event_Date:document.getElementById("Event_Date").value,
            Event_Duration:+document.getElementById("Event_Duration").value,
            Event_Location:document.getElementById("Event_Location").value,
            Number_of_Participants:+document.getElementById("Number_of_Participants").value,
            Team_ID:+document.getElementById("Team_ID").value
        };
        await fetch("/addEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
        document.getElementById("eventForm").reset();
        loadEvents();
    });

    loadEvents();
</script>
</body>
</html>